#!/usr/bin/env bash

DIR=$(dirname "$0")
LOCKPIC=$DIR/lock.png

# Pause spotify
dbus-send --print-reply --dest=org.mpris.MediaPlayer2.spotify /org/mpris/MediaPlayer2 org.mpris.MediaPlayer2.Player.Stop

# Grab screen info
xdpyinfo -ext XINERAMA | sed '/^  head #/!d;s///' |
while IFS=' :x@,' read i w h x y; do
    maim --geometry=${w}x${h}+${x}+${y} /tmp/head_$i.png
done

# Pixelate screens and print the lock on them
if [ -e /tmp/head_1.png ]; then
    convert /tmp/head_0.png -scale 10% -scale 1000% $LOCKPIC -gravity center -composite '(' /tmp/head_1.png -scale 10% -scale 1000% $LOCKPIC -gravity center -composite ')' +append /tmp/screen.png
else
  convert /tmp/head_0.png -scale 10% -scale 1000% $LOCKPIC -gravity center -composite /tmp/screen.png
fi

# Lock
i3lock  -e -i /tmp/screen.png
rm -f /tmp/head*.png /tmp/screen.
